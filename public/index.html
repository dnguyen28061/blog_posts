<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Node.js Blog</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; color: #333; }
        .container { max-width: 800px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h1, h2 { color: #0056b3; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input[type="text"],
        .form-group textarea {
            width: calc(100% - 22px);
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .form-group textarea { resize: vertical; min-height: 100px; }
        .btn {
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .btn:hover { background-color: #0056b3; }
        .post-list { margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px; }
        .post-list-item {
            background: #e9ecef;
            padding: 10px 15px;
            margin-bottom: 10px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .post-list-item h3 { margin: 0; color: #333; cursor: pointer; }
        .post-list-item h3:hover { text-decoration: underline; }
        .post-detail { margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px; display: none; }
        .post-detail h2 { margin-top: 0; }
        .post-detail p { line-height: 1.6; }
        .actions button { margin-left: 10px; }
        .database-selector { margin-bottom: 20px; }
        .database-selector label { font-weight: bold; margin-right: 10px; }
        .database-selector select { padding: 8px; border-radius: 4px; border: 1px solid #ddd; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Node.js Blog Application</h1>

        <div class="database-selector">
            <label for="db-select">Select Database:</label>
            <select id="db-select">
                <option value="pg">PostgreSQL</option>
                <option value="mongo">MongoDB</option>
                <option value="cassandra">Cassandra</option>
            </select>
        </div>

        <div id="post-form-section">
            <h2>Create/Edit Post</h2>
            <form id="post-form">
                <input type="hidden" id="post-id">
                <div class="form-group">
                    <label for="title">Title:</label>
                    <input type="text" id="title" required>
                </div>
                <div class="form-group">
                    <label for="author">Author:</label>
                    <input type="text" id="author" required>
                </div>
                <div class="form-group">
                    <label for="content">Content:</label>
                    <textarea id="content" required></textarea>
                </div>
                <button type="submit" class="btn">Save Post</button>
                <button type="button" class="btn" id="cancel-edit" style="display:none;">Cancel Edit</button>
            </form>
        </div>

        <div class="post-list-section">
            <h2>All Posts</h2>
            <div id="posts-list" class="post-list">
                <!-- Posts will be loaded here -->
                <div class="post-list-item">
                    <h3>Example Post Title</h3>
                    <div class="actions">
                        <button class="btn edit-btn">Edit</button>
                        <button class="btn delete-btn">Delete</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="post-detail-section" class="post-detail">
            <h2 id="detail-title"></h2>
            <p><strong>Author:</strong> <span id="detail-author"></span></p>
            <p id="detail-content"></p>
            <button class="btn" id="back-to-list">Back to List</button>
        </div>
    </div>

    <script>
        // Placeholder for JavaScript logic
        document.addEventListener('DOMContentLoaded', () => {
            const dbSelect = document.getElementById('db-select');
            const postForm = document.getElementById('post-form');
            const postIdInput = document.getElementById('post-id');
            const titleInput = document.getElementById('title');
            const authorInput = document.getElementById('author');
            const contentInput = document.getElementById('content');
            const postsList = document.getElementById('posts-list');
            const postDetailSection = document.getElementById('post-detail-section');
            const detailTitle = document.getElementById('detail-title');
            const detailAuthor = document.getElementById('detail-author');
            const detailContent = document.getElementById('detail-content');
            const backToListBtn = document.getElementById('back-to-list');
            const cancelEditBtn = document.getElementById('cancel-edit');
            const savePostBtn = document.querySelector('#post-form button[type="submit"]');

            // For Issue #3, we assume PostgreSQL is selected.
            // The database switching logic will be implemented in Issue #7.
            let currentDatabase = 'pg'; 
            dbSelect.value = currentDatabase; // Set the dropdown to PostgreSQL

            // Disable the database selector for now, re-enable in Issue #7
            dbSelect.disabled = true;

            // Function to reset the form
            function resetForm() {
                postForm.reset();
                postIdInput.value = '';
                savePostBtn.textContent = 'Save Post';
                cancelEditBtn.style.display = 'none';
            }

            // Load all posts
            async function loadPosts() {
                postsList.innerHTML = ''; // Clear current list
                try {
                    const response = await fetch(`/api/posts/${currentDatabase}`);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const posts = await response.json();
                    if (posts.length === 0) {
                        postsList.innerHTML = '<div class="post-list-item"><h3>No posts yet.</h3></div>';
                        return;
                    }
                    posts.forEach(post => {
                        const postItem = document.createElement('div');
                        postItem.classList.add('post-list-item');
                        postItem.dataset.id = post.id;
                        postItem.innerHTML = `
                            <h3>${post.title}</h3>
                            <div class="actions">
                                <button class="btn edit-btn">Edit</button>
                                <button class="btn delete-btn">Delete</button>
                            </div>
                        `;
                        postsList.appendChild(postItem);
                    });
                } catch (error) {
                    console.error('Error loading posts:', error);
                    postsList.innerHTML = '<div class="post-list-item" style="color: red;"><h3>Error loading posts. See console for details.</h3></div>';
                }
            }

            // View a single post
            async function viewPost(id) {
                try {
                    const response = await fetch(`/api/posts/${currentDatabase}/${id}`);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const post = await response.json();
                    detailTitle.textContent = post.title;
                    detailAuthor.textContent = post.author;
                    detailContent.textContent = post.content;

                    postDetailSection.style.display = 'block';
                    document.querySelector('.post-list-section').style.display = 'none';
                    document.getElementById('post-form-section').style.display = 'none';
                } catch (error) {
                    console.error(`Error viewing post ${id}:`, error);
                    alert('Error viewing post.');
                }
            }

            // Edit a post
            async function editPost(id) {
                try {
                    const response = await fetch(`/api/posts/${currentDatabase}/${id}`);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const post = await response.json();
                    postIdInput.value = post.id;
                    titleInput.value = post.title;
                    authorInput.value = post.author;
                    contentInput.value = post.content;

                    savePostBtn.textContent = 'Update Post';
                    cancelEditBtn.style.display = 'inline-block';
                } catch (error) {
                    console.error(`Error fetching post ${id} for edit:`, error);
                    alert('Error loading post for edit.');
                }
            }

            // Delete a post
            async function deletePost(id) {
                try {
                    const response = await fetch(`/api/posts/${currentDatabase}/${id}`, {
                        method: 'DELETE'
                    });
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    alert('Post deleted successfully!');
                    loadPosts(); // Reload posts after deletion
                } catch (error) {
                    console.error(`Error deleting post ${id}:`, error);
                    alert('Error deleting post.');
                }
            }

            // Event Listeners
            postForm.addEventListener('submit', async (event) => {
                event.preventDefault();
                const postId = postIdInput.value;
                const postData = {
                    title: titleInput.value,
                    author: authorInput.value,
                    content: contentInput.value
                };

                const method = postId ? 'PUT' : 'POST';
                const url = postId ? `/api/posts/${currentDatabase}/${postId}` : `/api/posts/${currentDatabase}`;

                try {
                    const response = await fetch(url, {
                        method: method,
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(postData)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    alert(`Post ${postId ? 'updated' : 'created'} successfully!`);
                    resetForm();
                    loadPosts(); // Reload posts after creation/update
                } catch (error) {
                    console.error(`Error ${postId ? 'updating' : 'creating'} post:`, error);
                    alert(`Error ${postId ? 'updating' : 'creating'} post.`);
                }
            });

            cancelEditBtn.addEventListener('click', resetForm);

            postsList.addEventListener('click', (event) => {
                const postItem = event.target.closest('.post-list-item');
                if (!postItem) return; // Click was not on a post item

                const postId = postItem.dataset.id;

                if (event.target.classList.contains('edit-btn')) {
                    editPost(postId);
                } else if (event.target.classList.contains('delete-btn')) {
                    if (confirm('Are you sure you want to delete this post?')) {
                        deletePost(postId);
                    }
                } else if (event.target.tagName === 'H3') {
                    viewPost(postId);
                }
            });

            backToListBtn.addEventListener('click', () => {
                postDetailSection.style.display = 'none';
                document.querySelector('.post-list-section').style.display = 'block';
                document.getElementById('post-form-section').style.display = 'block';
                loadPosts(); // Reload posts when returning to list
            });

            // Initial load of posts
            loadPosts();
        });
    </script>
</body>
</html>